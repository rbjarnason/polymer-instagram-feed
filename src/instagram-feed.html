<link rel="import" href="../bower_components/iron-jsonp-library/iron-jsonp-library.html">

<dom-module id='instagram-feed'>


  <template>
    <style is="custom-style">
    </style>

     <iron-jsonp-library
            library-url="https://api.instagram.com/v1/users/{{userId}}/media/recent?access_token={{accessToken}}&count={{count}}&callback="
            id="ajax"
            notify-event="api-load"
            library-loaded="{{loaded}}"></iron-jsonp-library>

    <ul class="instagram-feed">
      <template is="dom-repeat" items="{{data}}" as="item">
        <li class="item">
          <a href="{{item.link}}">
            <img src="{{item.imageSrc}}">
          </a>
        </li>
      </template>
   </ul>
  </template>

  <script>
    Polymer('instagram-feed', {

      is: 'instagram-feed',

      properties: {
        count: {
          type: Number,
          value: 12
        },

        accessToken: {
          type: String,
          value: ""
        },

        userId: {
          type: String,
          value: ""
        },

        imageSize: {
          type: String,
          value: 'small'
        },

        imageSizeMap:  {
          type: Object,
          value: {
            'small': 'thumbnail',
            'medium': 'low_resolution',
            'large': 'standard_resolution'
          }
        }
      },

      buildModel: function (response, context) {
        var data = response.data,
                itemsLength = data.length,
                items = [],
                imageSize,
                i;

        for (i=0; i<itemsLength; i++) {
          imageSize = imageSizeMap[context.imageSize];

          items.push({
            link: data[i].link,
            imageSrc: data[i].images[imageSize].url,
          });
      }

      return { items: items };
    },

    ready: function () {
        this.$.ajax.addEventListener('response', function (e) {
          debugger;
          this.$.items.model = this.buildModel(e.detail.response, this);
        }.bind(this));
      }
    });
  </script>
</dom-module>
